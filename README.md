# API - Documenta√ß√£o Completa

## üìã √çndice
- [Vis√£o Geral](#vis√£o-geral)
- [Instala√ß√£o](#instala√ß√£o)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Como Usar](#como-usar)
- [Endpoints Dispon√≠veis](#endpoints-dispon√≠veis)
- [Seguran√ßa](#seguran√ßa)
- [Como Adicionar Novas Funcionalidades](#como-adicionar-novas-funcionalidades)
- [Organiza√ß√£o de Arquivos](#organiza√ß√£o-de-arquivos)
- [Boas Pr√°ticas](#boas-pr√°ticas)

---

## üéØ Vis√£o Geral

API RESTful constru√≠da com Node.js e Express, com sistema de seguran√ßa por IP e estrutura modular para f√°cil escalabilidade.

**Caracter√≠sticas:**
- ‚úÖ Prote√ß√£o por whitelist de IPs
- ‚úÖ Estrutura modular (f√°cil manuten√ß√£o)
- ‚úÖ Valida√ß√£o de CPF
- ‚úÖ Leitura de arquivos PDF
- ‚úÖ C√≥digo organizado em camadas (routes, controllers, middlewares, utils)
- ‚úÖ Sistema de logs profissional (Winston)
- ‚úÖ Vari√°veis de ambiente (.env)
- ‚úÖ Models para estruturas de dados
- ‚úÖ Services para integra√ß√µes externas

---

## üöÄ Instala√ß√£o

### Pr√©-requisitos
- Node.js >= 22.18.0
- npm ou yarn

### Passo a Passo

1. **Clone ou navegue at√© o projeto:**
```bash
cd "c:\Users\Gilberto Silva\Documents\GitHub\api"
```

2. **Instale as depend√™ncias:**
```bash
npm install
```

3. **Configure os IPs autorizados:**
Edite o arquivo `.env` e adicione os IPs permitidos (separados por v√≠rgula):
```env
ALLOWED_IPS=127.0.0.1,::1,192.168.168.100
```

Ou edite diretamente `src/config/allowedIPs.js`

4. **Inicie o servidor:**
```bash
npm start
```

5. **Teste a API:**
Abra o navegador em: `http://localhost:3000`

---

## üìÅ Estrutura do Projeto

```
api/
‚îú‚îÄ‚îÄ server.js                    # Arquivo principal da aplica√ß√£o
‚îú‚îÄ‚îÄ package.json                 # Depend√™ncias e scripts
‚îú‚îÄ‚îÄ .env                         # Vari√°veis de ambiente (N√ÉO commitado)
‚îú‚îÄ‚îÄ .env.example                 # Exemplo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .gitignore                   # Arquivos ignorados pelo Git
‚îú‚îÄ‚îÄ README.md                    # Este arquivo
‚îú‚îÄ‚îÄ QUICK_REFERENCE.txt          # Refer√™ncia r√°pida
‚îú‚îÄ‚îÄ ESTRUTURA.md                 # Documenta√ß√£o da estrutura
‚îÇ
‚îú‚îÄ‚îÄ logs/                        # Arquivos de log (gerados automaticamente)
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ all.log                  # Todos os logs
‚îÇ   ‚îî‚îÄ‚îÄ error.log                # Apenas erros
‚îÇ
‚îî‚îÄ‚îÄ src/                         # C√≥digo-fonte organizado
    ‚îú‚îÄ‚îÄ config/                  # Configura√ß√µes centralizadas
    ‚îÇ   ‚îú‚îÄ‚îÄ index.js             # Configura√ß√µes gerais (carrega do .env)
    ‚îÇ   ‚îú‚îÄ‚îÄ logger.js            # Configura√ß√£o do sistema de logs
    ‚îÇ   ‚îî‚îÄ‚îÄ allowedIPs.js        # Lista de IPs autorizados
    ‚îÇ
    ‚îú‚îÄ‚îÄ middlewares/             # Middlewares personalizados
    ‚îÇ   ‚îú‚îÄ‚îÄ ipFilter.js          # Filtro de seguran√ßa por IP
    ‚îÇ   ‚îî‚îÄ‚îÄ requestLogger.js     # Logger de requisi√ß√µes HTTP
    ‚îÇ
    ‚îú‚îÄ‚îÄ routes/                  # Defini√ß√£o de rotas
    ‚îÇ   ‚îú‚îÄ‚îÄ index.js             # Rota raiz (documenta√ß√£o)
    ‚îÇ   ‚îú‚îÄ‚îÄ cpfRoutes.js         # Rotas relacionadas a CPF
    ‚îÇ   ‚îî‚îÄ‚îÄ pdfRoutes.js         # Rotas relacionadas a PDF
    ‚îÇ
    ‚îú‚îÄ‚îÄ controllers/             # L√≥gica de neg√≥cio
    ‚îÇ   ‚îú‚îÄ‚îÄ cpfController.js     # Controlador de CPF
    ‚îÇ   ‚îî‚îÄ‚îÄ pdfController.js     # Controlador de PDF
    ‚îÇ
    ‚îú‚îÄ‚îÄ models/                  # Estruturas de dados
    ‚îÇ   ‚îú‚îÄ‚îÄ User.js              # Model de usu√°rio (exemplo)
    ‚îÇ   ‚îî‚îÄ‚îÄ Document.js          # Model de documento
    ‚îÇ
    ‚îú‚îÄ‚îÄ services/                # Integra√ß√µes externas
    ‚îÇ   ‚îú‚îÄ‚îÄ supabaseService.js   # Servi√ßo Supabase (exemplo)
    ‚îÇ   ‚îî‚îÄ‚îÄ emailService.js      # Servi√ßo de email (exemplo)
    ‚îÇ
    ‚îî‚îÄ‚îÄ utils/                   # Fun√ß√µes auxiliares
        ‚îî‚îÄ‚îÄ cpfValidator.js      # Validador de CPF
```

---

## üíª Como Usar

### Acessar Documenta√ß√£o da API
```bash
GET http://localhost:3000/
```

Retorna JSON com todos os endpoints dispon√≠veis.

---

## üîå Endpoints Dispon√≠veis

### 1. **GET /** - Documenta√ß√£o
Retorna lista de endpoints e fun√ß√µes dispon√≠veis.

**Exemplo de resposta:**
```json
{
  "message": "Bem-vindo √† API!",
  "endpoints": [
    "POST /validate-cpf: Valida um CPF",
    "POST /read-pdf: L√™ arquivo PDF"
  ]
}
```

---

### 2. **POST /validate-cpf** - Validar CPF

**Body (JSON):**
```json
{
  "cpf": "12345678901"
}
```

**Resposta de sucesso:**
```json
{
  "valid": true,
  "message": "CPF v√°lido."
}
```

**Resposta de erro:**
```json
{
  "valid": false,
  "message": "CPF inv√°lido."
}
```

---

### 3. **POST /read-pdf** - Ler PDF

**Body (form-data):**
- Key: `pdf`
- Value: [arquivo PDF]

**Resposta de sucesso:**
```json
{
  "success": true,
  "text": "Texto extra√≠do do PDF...",
  "pages": 5,
  "info": { /* metadados do PDF */ }
}
```

---

## üîí Seguran√ßa

### Prote√ß√£o por IP
Apenas IPs autorizados podem acessar a API. IPs n√£o autorizados recebem:

**Resposta de bloqueio:**
```json
{
  "error": "Pare de tentar hackear! ;)"
}
```

### Como Adicionar IPs Autorizados

**M√©todo 1: Via arquivo .env (Recomendado)**
Edite `.env` e adicione IPs separados por v√≠rgula:
```env
ALLOWED_IPS=127.0.0.1,::1,192.168.168.100,192.168.1.50
```

**M√©todo 2: Via c√≥digo**
Edite `src/config/allowedIPs.js` diretamente (n√£o recomendado para produ√ß√£o)

---

## ‚ûï Como Adicionar Novas Funcionalidades

### Passo 1: Criar o Controlador
Crie um arquivo em `src/controllers/`:

**Exemplo:** `src/controllers/emailController.js`
```javascript
export const sendEmail = async (req, res) => {
    try {
        const { to, subject, body } = req.body;
        
        // Sua l√≥gica aqui
        
        res.status(200).json({ success: true, message: 'Email enviado!' });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
};
```

---

### Passo 2: Criar a Rota
Crie um arquivo em `src/routes/`:

**Exemplo:** `src/routes/emailRoutes.js`
```javascript
import express from 'express';
import { sendEmail } from '../controllers/emailController.js';

const router = express.Router();

router.post('/send-email', sendEmail);

export default router;
```

---

### Passo 3: Registrar no server.js
Adicione a importa√ß√£o e use a rota:

```javascript
import emailRoutes from './src/routes/emailRoutes.js';

// ... c√≥digo existente ...

app.use(emailRoutes);
```

---

### Passo 4: Atualizar Documenta√ß√£o
Adicione ao `src/routes/index.js`:

```javascript
endpoints: [
    'POST /validate-cpf: Valida um CPF',
    'POST /read-pdf: L√™ arquivo PDF',
    'POST /send-email: Envia um email'  // Nova linha
]
```

---

## üìÇ Organiza√ß√£o de Arquivos

### Novas Pastas Implementadas

**1. `src/config/` - Configura√ß√µes centralizadas**
- `index.js` - Carrega todas as vari√°veis do .env
- `logger.js` - Sistema de logs com Winston
- `allowedIPs.js` - IPs autorizados

**2. `src/models/` - Estruturas de dados**
- `User.js` - Model de usu√°rio com valida√ß√µes
- `Document.js` - Model de documento/PDF

**3. `src/services/` - Integra√ß√µes externas**
- `supabaseService.js` - Exemplo para Supabase
- `emailService.js` - Exemplo para envio de emails

**4. `logs/` - Arquivos de log**
- `all.log` - Todos os logs
- `error.log` - Apenas erros

---

### Sistema de Logs

**N√≠veis de log dispon√≠veis:**
```env
LOG_LEVEL=debug   # Tudo (desenvolvimento)
LOG_LEVEL=http    # Requisi√ß√µes HTTP
LOG_LEVEL=info    # Informa√ß√µes gerais (padr√£o)
LOG_LEVEL=warn    # Avisos
LOG_LEVEL=error   # Apenas erros
```

**Usar no c√≥digo:**
```javascript
import logger from '../config/logger.js';

logger.info('Mensagem informativa');
logger.warn('Aviso');
logger.error('Erro cr√≠tico');
logger.debug('Debug detalhado');
logger.http('Requisi√ß√£o HTTP');
```

**Logs autom√°ticos:**
- ‚úÖ Todas as requisi√ß√µes HTTP s√£o logadas
- ‚úÖ IPs bloqueados s√£o registrados
- ‚úÖ Erros s√£o salvos em `logs/error.log`

---

### Vari√°veis de Ambiente (.env)

**Vantagens:**
- üîí Senhas e chaves secretas fora do c√≥digo
- üö´ `.env` n√£o √© commitado no Git
- üîÑ F√°cil mudar configura√ß√µes por ambiente

**Arquivo `.env.example`:**
Use como template. Copie para `.env` e configure:
```bash
cp .env.example .env
```

**Acessar vari√°veis:**
```javascript
import config from './src/config/index.js';

console.log(config.port);        // 3000
console.log(config.nodeEnv);     // development
console.log(config.jwt.secret);  // sua chave JWT
```

---

### Models (Estruturas de Dados)

**Quando usar:**
- Padronizar estrutura de dados
- Adicionar valida√ß√µes
- Garantir consist√™ncia

**Exemplo de uso:**
```javascript
import { User } from '../models/User.js';

const user = new User({
    name: 'Jo√£o Silva',
    email: 'joao@email.com',
    cpf: '12345678901'
});

const validation = user.validate();
if (!validation.isValid) {
    console.log(validation.errors);
}

// Retornar sem dados sens√≠veis
res.json(user.toJSON());
```

---

### Services (Integra√ß√µes Externas)

**Quando usar:**
- Integrar com APIs externas (Supabase, OpenAI, etc.)
- Enviar emails
- Processar pagamentos
- Qualquer servi√ßo externo

**Exemplo:**
```javascript
import emailService from '../services/emailService.js';

await emailService.sendEmail({
    to: 'cliente@email.com',
    subject: 'Bem-vindo!',
    text: 'Ol√°, seja bem-vindo!'
});
```

---

### Como Criar Novas Pastas

**Para servi√ßos externos:**
```bash
mkdir src/services
```

Exemplo: `src/services/supabaseService.js`

**Para modelos de dados:**
```bash
mkdir src/models
```

Exemplo: `src/models/User.js`

**Para valida√ß√µes:**
```bash
mkdir src/validators
```

Exemplo: `src/validators/emailValidator.js`

---

### Como Renomear Arquivos/Pastas

**Usando terminal:**
```powershell
# Renomear arquivo
mv src/utils/cpfValidator.js src/utils/cpfUtils.js

# Renomear pasta
mv src/controllers src/handlers
```

**Importante:** Ap√≥s renomear, atualize todos os imports nos arquivos que usam o arquivo renomeado!

---

## üì¶ Como Instalar Novas Depend√™ncias

### Instalar pacote npm
```bash
npm install nome-do-pacote
```

**Exemplos comuns:**
```bash
npm install axios          # Para fazer requisi√ß√µes HTTP
npm install dotenv         # Para vari√°veis de ambiente
npm install bcrypt         # Para criptografia de senhas
npm install jsonwebtoken   # Para autentica√ß√£o JWT
npm install nodemailer     # Para envio de emails
```

---

### Usar o pacote instalado
```javascript
import axios from 'axios';
import bcrypt from 'bcrypt';
import dotenv from 'dotenv';
```

---

## üé® Boas Pr√°ticas

### 1. **Separa√ß√£o de Responsabilidades**
- **Routes:** Apenas definem endpoints
- **Controllers:** Cont√©m l√≥gica de neg√≥cio
- **Utils:** Fun√ß√µes auxiliares reutiliz√°veis
- **Middlewares:** Fun√ß√µes que processam requisi√ß√µes

### 2. **Nomenclatura**
- Arquivos: `camelCase.js`
- Constantes: `UPPER_CASE`
- Fun√ß√µes: `camelCase()`
- Classes: `PascalCase`

### 3. **Tratamento de Erros**
Sempre use try-catch nos controllers:
```javascript
try {
    // c√≥digo
} catch (error) {
    console.error('Erro:', error);
    res.status(500).json({ error: error.message });
}
```

### 4. **Valida√ß√£o de Dados**
Sempre valide dados de entrada:
```javascript
if (!cpf) {
    return res.status(400).json({ error: 'CPF n√£o fornecido.' });
}
```

### 5. **Versionamento**
Para APIs grandes, use versionamento:
```javascript
app.use('/api/v1', routesV1);
app.use('/api/v2', routesV2);
```

---

## üõ°Ô∏è Sobre Seguran√ßa do C√≥digo

### O cliente pode ver o c√≥digo?
**N√ÉO!** O c√≥digo do backend roda no servidor, n√£o no navegador.

**O que o cliente v√™:**
- ‚úÖ Apenas as respostas JSON da API
- ‚úÖ URLs dos endpoints

**O que o cliente N√ÉO v√™:**
- ‚ùå C√≥digo-fonte do servidor
- ‚ùå L√≥gica de neg√≥cio
- ‚ùå Valida√ß√µes internas
- ‚ùå Conex√µes com banco de dados

**No navegador (F12):**
O cliente s√≥ v√™ as requisi√ß√µes HTTP e respostas, nunca o c√≥digo Node.js do servidor.

---

## üîß Scripts Dispon√≠veis

```bash
npm start        # Inicia o servidor
npm test         # Executa testes (ainda n√£o configurado)
```

---

## üìù Atualizando a Documenta√ß√£o

Sempre que adicionar novos endpoints:

1. Atualize `README.md` (este arquivo)
2. Atualize `documentation.txt`
3. Atualize `src/routes/index.js` (documenta√ß√£o da API)

---

## üö® Troubleshooting

### Erro: "Cannot find module"
```bash
npm install  # Reinstale as depend√™ncias
```

### Erro: "Port 3000 already in use"
```bash
# Encontre e mate o processo:
netstat -ano | findstr :3000
taskkill /PID [n√∫mero_do_pid] /F
```

### Acesso negado (403)
Verifique se seu IP est√° em `src/config/allowedIPs.js`

---

## üìû Suporte

Para d√∫vidas ou problemas:
- Verifique a documenta√ß√£o completa
- Consulte `documentation.txt` para refer√™ncia r√°pida
- Revise a estrutura de pastas

---

**√öltima atualiza√ß√£o:** Outubro 2025
**Vers√£o da API:** 1.0.0
**Node.js:** >= 22.18.0
